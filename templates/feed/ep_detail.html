{% extends 'base_nav.html' %}
{% load static %}
{% block title %}Episode Detail{% endblock %}

{% block content %}
{% static "" as STATIC_URL %}
<script>
$(function() {
    $('#like').on('click', function() {
        $.ajax({
            'url':'{% url "feed:change_like" %}',
            'type':'GET',
            'data':{
                'ep_id':$(this).attr('data-episode-id'),
            },
            'dataType':'json'
        })
        .done(function(data){
            $('#like').html(data.btn_display)
        })
        .fail(function(data){
            $('#error').html('<p>' + '登録できませんでした' +'</p>')
        })
    });
});
</script>
<div id="page-wrapper">
  <div class="row">
    <div class="col-lg-9">
      {% if episode %}
        <h3>{{ episode.title }}</h3>
        {% if like %}
        <p><button type="button" id="like" data-episode-id="{{ episode.id }}" class="btn btn-primary btn-xs"><i class="fa fa-thumbs-o-down"></i> Likeから除外する</button></p>
        {% else %}
        <p><button type="button" id="like" data-episode-id="{{ episode.id }}" class="btn btn-primary btn-xs" ><i class="fa fa-thumbs-o-up"></i> Like</button></p>
        {% endif %}
        <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModal">add collection</button>
        <audio src="{{ episode.audio_url }}" preload="auto"></audio>
          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                        
                    <h4 class="modal-title" id="modal-label">コレクションに追加</h4>
                  </div>
                  <div class="modal-body">
                      <form action="" name="add_collection" method="GET">
                          {% csrf_token %}
                          {{ add_collection_form }}
                      </form>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                  </div>
                </div>
            </div>
          </div>
          <div id="error">
            {{ result }}
          </div>
          <p>{{ episode.description }}</p>
          <p>{{ episode.link }}</p>
          <p>{{ episode.audio_url }}</p>
          <p>{{ episode.published_time }}</p>
          <p>{{ episode.duration }}</p>
          <p>Channel: {{ episode.channel.title }}</p>
      {% else %}
          <p>エピソード情報が取得できませんでした</p>
      {% endif %}
    </div>
    <div class="col-lg-3">
      <div class="right-bar">
        {% if channel %}
        <img class="img-rounded" src="{{ STATIC_URL }}{{ channel.cover_image }}" width=180px/>
          <h4>{{ channel.title }}</h4>
          <p>{{ channel.description }}</p>
          <p>{{ channel.link }}</p>
          <p>{{ channel.feed_url }}</p>
          <p>{{ channel.author_name }}</p>
        {% else %}
          <p>チャンネル情報が取得できませんでした</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
