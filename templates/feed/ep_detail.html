{% extends 'base_nav.html' %}
{% load static %}
{% block title %}Episode Detail{% endblock %}

{% block content %}
{% static "" as STATIC_URL %}
<script>
$(function() {
    $('#like').on('click', function() {
        $.ajax({
            'url':'{% url "feed:change_like" %}',
            'type':'GET',
            'data':{
                'ep_id':$(this).attr('data-episode-id'),
            },
            'dataType':'json'
        })
        .done(function(data){
            $('#like').html(data.btn_display)
        })
        .fail(function(data){
            $('#error').html('<p>' + '登録できませんでした' +'</p>')
        })
    });
});
</script>
<div id="page-wrapper">
  <div class="row">
    <div class="ep-header clearfix">
      <div class="channel col-lg-3">
        {% if channel %}
          <img class="img-circle" src="{{ STATIC_URL }}{{ channel.cover_image }}" width=140px/>
          <h4>{{ channel.title }}</h4>
          <p class="author">{{ channel.author }}</p>
          <p class="description">{{ channel.description }}</p>
          <p class="link"><a href="{{ channel.link }}"><i class="fa fa-external-link fa-fw"></i> Website</a></p>
        {% else %}
          <p>チャンネル情報が取得できませんでした</p>
        {% endif %}
      </div>
      <div class="col-lg-9">
        {% if episode %}
          <p class="ep-date"><i class="fa fa-clock-o fa-fw"></i>{{ episode.published_time }}</p>
          <h3>{{ episode.title }}</h3>
          <audio controls>
            <source src="{{ episode.audio_url }}" type="audio/mp3">
          </audio>
          <div class="action">
          {% if like %}
          <p><button type="button" id="like" data-episode-id="{{ episode.id }}" class="btn btn-outline btn-default btn-xs"><i class="fa fa-heart"></i> Likeを外す</button></p>
          {% else %}
          <p><button type="button" id="like" data-episode-id="{{ episode.id }}" class="btn btn-outline btn-default btn-xs"><i class="fa fa-heart"></i> Like</button></p>
          {% endif %}
          <!-- <button class="btn btn-primary btn-xs" data-toggle="modal" data-target="#myModal">add collection</button> -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                        
                      <h4 class="modal-title" id="modal-label">コレクションに追加</h4>
                    </div>
                    <div class="modal-body">
                        <form action="" name="add_collection" method="GET">
                            {% csrf_token %}
                            {{ add_collection_form }}
                        </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                  </div>
              </div>
            </div>
            <div id="error">
              {{ result }}
            </div>
        {% else %}
            <p>エピソード情報が取得できませんでした</p>
        {% endif %}
        </div>
      </div>
    </div>
    <div class="ep-body">
      <div class="col-lg-5">
        <p>{{ episode.description }}</p>
      </div>
      <div class="img-tile col-lg-7">
          <img id="img01" class="img-rounded" src="{{ STATIC_URL }}{{ channel.cover_image }}" width=130px/>
          <img id="img01" class="img-rounded" src="{{ STATIC_URL }}{{ channel.cover_image }}" width=130px/>
          <img id="img01" class="img-rounded" src="{{ STATIC_URL }}{{ channel.cover_image }}" width=130px/>
          <img id="img01" class="img-rounded" src="{{ STATIC_URL }}{{ channel.cover_image }}" width=130px/>
      </div>
    </div>
  </div>
</div>
{% endblock %}
