{% extends 'base_nav.html' %}
{% load static %}
{% block title %}Episode Detail{% endblock %}
<script>
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  var csrftoken = getCookie('csrftoken');

  function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
      beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
      }
  });

  $('#postform').submit(function() {
        $.ajax({
            'url':'{% url "api_v1_posts" %}',
            'type':'POST',
            'data':{
                'result':$('#result').val(),
            },
            'dataType':'json',
            'success':function(r){
                message = r.id;
                alert(message);           
            },
        });
        return false;
    });
</script>
{% block content %}
{% static "" as STATIC_URL %}
<div id="wrapper">
  <div id="page-wrapper">
    <div class="row">
      <div class="col-lg-12 full-width margin-top-20percent">
        {% if episode %}
        <h3>{{ episode.title }}</h3>
            <div class="panel-body">
            <img src="{{ STATIC_URL }}{{ episode.channel.cover_image }}" width=150px/>
            </div>
            {% if like %}
                <p><button type="button" class="btn btn-primary btn-xs">Likeから除外する</button></p>
                <form id="postform" action="{% url 'api_v1_posts' %}" method="POST">
                  <input type="hidden" name="ep_id" value="{{ episode.id }}">
                  <input type="submit" value="作成">
                </form>
            {% else %}
                <p><button type="button" class="btn btn-primary btn-xs">Like</button></p>
            {% endif %}
            <div id="result">
              {{ result }}
            </div>
            <p>{{ episode.description }}</p>
            <p>{{ episode.link }}</p>
            <p>{{ episode.release_date }}</p>
            <p>{{ episode.duration }}</p>
            <p>Channel: {{ episode.channel.title }}</p>
        {% else %}
            <p>エピソード情報が取得できませんでした</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
